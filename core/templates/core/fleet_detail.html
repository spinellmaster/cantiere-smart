{% extends "core/base.html" %}
{% block title %}{{ v.plate }} · CantiereSmart{% endblock %}
{% block content %}
  <div style="display:flex; align-items:center; justify-content:space-between; margin-bottom:12px">
    <div>
      <h2 style="margin:0">{{ v.plate }} — {{ v.name }}</h2>
      <div style="font-size:12px; color:#9a9a9a">{{ v.vehicle_type }} · Stato:
        <b class="badge" style="{% if v.status == 'available' %}color:#00d084{% elif v.status == 'in_use' %}color:#F4B000{% elif v.status == 'maintenance' %}color:#FF7A00{% else %}color:#ff6b6b{% endif %}">{{ v.status }}</b>
      </div>
      <div style="font-size:12px; color:#9a9a9a">Km: {{ v.odometer_km }} · Carburante: {{ v.fuel_level_percent }}%</div>
    </div>
    <div style="display:flex; gap:8px">
      {% if v.status == 'available' %}
        <a class="btn" href="/fleet/{{ v.id }}/checkout/">Ritira</a>
      {% endif %}
      <a class="btn secondary" href="/fleet/">Elenco</a>
    </div>
  </div>

  {% if active %}
    <div class="card" style="margin-bottom:12px">
      <div style="font-weight:800; margin-bottom:6px">Sessione attiva</div>
      <div>Utente: <b>{{ active.user.username }}</b> · Progetto: {{ active.project.name|default:"-" }}</div>
      <div>Inizio: {{ active.start_time }}</div>
      <div>Km iniziali: {{ active.start_odometer_km }} · Carburante iniziale: {{ active.start_fuel_percent }}%</div>
      <div style="margin-top:8px; display:flex; gap:8px">
        <a class="btn" href="/fleet/session/{{ active.id }}/checkin/">Riconsegna</a>
      </div>
    </div>
  {% endif %}

  <div class="card">
    <div style="font-weight:800; margin-bottom:8px">Storico utilizzi</div>
    {% if history %}
      <div style="display:grid; gap:8px">
        {% for s in history %}
          <div class="card" style="padding:10px">
            <div style="display:flex; justify-content:space-between">
              <div>
                <div style="font-weight:700">Utente: {{ s.user.username }} · Progetto: {{ s.project.name|default:"-" }}</div>
                <div style="font-size:12px; color:#9a9a9a">
                  {{ s.start_time }} → {{ s.end_time|default:"(in corso)" }}
                </div>
                <div style="font-size:12px; color:#cfcfcf">
                  Km: {{ s.start_odometer_km }} → {{ s.end_odometer_km|default:"-" }}
                  · Carburante: {{ s.start_fuel_percent }}% → {{ s.end_fuel_percent|default:"-" }}%
                </div>
                {% if s.notes_out %}<div style="font-size:12px; color:#cfcfcf">Note ritiro: {{ s.notes_out }}</div>{% endif %}
                {% if s.notes_in %}<div style="font-size:12px; color:#cfcfcf">Note rientro: {{ s.notes_in }}</div>{% endif %}
                {% if s.damages_report %}<div style="font-size:12px; color:#ffb3b3">Danni: {{ s.damages_report }}</div>{% endif %}
                {% if s.photos_urls %}
                  <div style="font-size:12px; color:#9a9a9a">Foto:<br>{{ s.photos_urls|linebreaksbr }}</div>
                {% endif %}
              </div>
              {% if not s.end_time and s.user_id == request.user.id %}
                <div><a class="btn" href="/fleet/session/{{ s.id }}/checkin/">Riconsegna</a></div>
              {% endif %}
            </div>
          </div>
        {% endfor %}
      </div>
    {% else %}
      <div style="font-size:14px; color:#9a9a9a">Nessun utilizzo registrato.</div>
    {% endif %}
  </div>
{% endblock %}
