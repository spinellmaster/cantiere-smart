{% with wi=node.node children=node.children %}
  <li style="margin:6px 0; padding-left:0">
    <div class="card" style="padding:10px">
      <div style="display:flex; align-items:center; justify-content:space-between; gap:8px">
        <div>
          <div style="font-weight:700">{{ wi.name }}</div>
          <div style="font-size:12px; color:#9a9a9a">
            Stato:
            <b style="color:#F4B000">
              {% if wi.status == 'open' %}Aperta{% elif wi.status == 'in_progress' %}In corso{% elif wi.status == 'paused' %}In pausa{% else %}Completata{% endif %}
            </b>
            · Peso: {{ wi.weight }} · Ordine: {{ wi.sort_order }}
          </div>
          <div style="margin-top:6px; height:8px; background:#222; border:1px solid #333; border-radius:6px; overflow:hidden">
            <div style="height:100%; width:{{ wi.progress }}%; background:#F4B000"></div>
          </div>
        </div>
        <div style="display:flex; gap:6px; flex-wrap:wrap">
          <a class="btn secondary" href="/work-items/{{ wi.id }}/edit/">Modifica</a>
          <a class="btn secondary" href="/work-items/{{ wi.id }}/delete/" onclick="return confirm('Eliminare questa lavorazione? I figli bloccano la cancellazione.');">Elimina</a>
          <!-- Stati rapidi -->
          <a class="btn secondary" href="/work-items/{{ wi.id }}/status/open/">Apri</a>
          <a class="btn secondary" href="/work-items/{{ wi.id }}/status/in_progress/">In corso</a>
          <a class="btn secondary" href="/work-items/{{ wi.id }}/status/paused/">Pausa</a>
          <a class="btn secondary" href="/work-items/{{ wi.id }}/status/done/">Chiudi</a>
          <!-- Progress rapidi -->
          <a class="btn secondary" href="/work-items/{{ wi.id }}/progress/0/">0%</a>
          <a class="btn secondary" href="/work-items/{{ wi.id }}/progress/25/">25%</a>
          <a class="btn secondary" href="/work-items/{{ wi.id }}/progress/50/">50%</a>
          <a class="btn secondary" href="/work-items/{{ wi.id }}/progress/75/">75%</a>
          <a class="btn secondary" href="/work-items/{{ wi.id }}/progress/100/">100%</a>
        </div>
      </div>
    </div>
    {% if children and children|length %}
      <ul style="list-style:none; padding-left:18px; margin:6px 0 0 0">
        {% for kid in children %}
          {% include "core/partials/work_item_node.html" with node=kid %}
        {% endfor %}
      </ul>
    {% endif %}
  </li>
{% endwith %}
